<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>后台管理系统</title>
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<!-- bootstrap -->
	<link rel="stylesheet" href="../../src/libs/bootstrap-3.3.6/css/bootstrap.min.css">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="../../src/libs/font-awesome-4.5.0/css/font-awesome.min.css">
	<!-- 主题 -->
	<link rel="stylesheet" href="../../src/css/app.css">

	<!-- HTML5 Shim and Respond.js IE8 支持HTML5元素和媒体查询 -->
	<!-- 警告: Respond.js使用file://无法正常工作 -->
	<!--[if lt IE 9]>
	<script src="../../src/js/html5shiv.min.js"></script>
	<script src="../../src/js/respond.min.js"></script>
	<![endif]-->
</head>
<body>
<!-- 页面容器 -->
<div class="wrapper">
	<!-- Main content -->
	<section class="content">
		<div class="page">
			<div class="page-header">
				<h1 class="page-title">文件上传</h1>
			</div><!-- /.page-header -->
			<div class="page-body">
				<div class="panel panel-default">
					<div class="panel-heading">bootstrap-fileinput</div>
					<div class="panel-body">
						<form class="form-horizontal row">
							<div class="form-group">
								<label class="col-sm-3 col-md-2 control-label">带输入框</label>
								<div class="col-sm-7 col-md-5">
									<div class="fileinput fileinput-new input-group" data-provides="fileinput">
										<div class="form-control" data-trigger="fileinput"><i class="glyphicon glyphicon-file fileinput-exists"></i> <span class="fileinput-filename"></span></div>
										<span class="input-group-addon btn btn-default btn-file"><span class="fileinput-new">选择文件</span><span class="fileinput-exists">更改文件</span><input type="file" name=""></span>
										<a href="#" class="input-group-addon btn btn-default fileinput-exists" data-dismiss="fileinput">删除</a>
									</div>
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-3 col-md-2 control-label">不带输入框</label>
								<div class="col-sm-7">
									<div class="fileinput fileinput-new" data-provides="fileinput">
										<span class="btn btn-default btn-file"><span class="fileinput-new">选择文件</span><span class="fileinput-exists">更改文件</span><input type="file" name=""></span>
										<span class="fileinput-filename"></span>
										<a href="#" class="close fileinput-exists" data-dismiss="fileinput" style="float: none">&times;</a>
									</div>
								</div>
							</div>

							<div class="form-group">
								<input type="text" name="img" value="" hidden><!-- 存放图片在服务器的地址 -->
								<label class="col-sm-3 col-md-2 control-label">图片本地预览</label>
								<div class="col-sm-7">
									<div class="fileinput fileinput-exists" data-provides="fileinput" id="fileinput">
										<div class="fileinput-preview thumbnail" data-trigger="fileinput" style="width: 200px; height: 150px;">
											<img src="../../src/images/bg2.jpg" style="display:block;min-width:100%;min-height:100%">
										</div>
										<div>
											<span class="btn btn-default btn-file"><span class="fileinput-new">选择图片</span><span class="fileinput-exists">更改图片</span><input type="file" name=""></span>
											<a href="#" class="btn btn-default fileinput-exists" data-dismiss="fileinput">删除</a>
										</div>
									</div>
									<p class="text-muted">图片预览仅支持在 IE10+, FF3.6+, Safari6.0+, Chrome6.0+ and Opera11.1+</p>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 col-md-2 control-label">图片本地压缩</label>
								<div class="col-sm-7">
									<div class="fileinput fileinput-new" data-provides="fileinput">
										<div class="fileinput-preview thumbnail" data-trigger="fileinput" style="width: 200px; height: 150px;"></div>
										<div>
											<span class="btn btn-default btn-file"><span class="fileinput-new">选择图片</span><span class="fileinput-exists">更改图片</span><input type="file" name="" id="img-compress"></span>
											<a href="#" class="btn btn-default fileinput-exists" data-dismiss="fileinput">删除</a>
										</div>
									</div>
									<p class="text-muted">浏览器支持情况同预览，压缩将转为jpeg格式(png格式压缩率太小)，因此透明背景将转为黑色</p>
									<p class="text-muted">common.imgCompress返回图片base64编码，去除base64文件头后提交到后台可以直接存byte[] Image</p>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 col-md-2 control-label">图片本地裁剪</label>
								<div class="col-sm-9">
									<div style="margin-bottom:15px">
										<button type="button" class="btn btn-default" id="btn-upload">上传图片</button>
										<button type="button" class="btn btn-default" id="btn-upload-cropper">上传所选区域</button>
										<input type="file" name="avatar" id="cropper-input" hidden/>
									</div>
									<div class="preview-container">
										<div class="image-container target" id="cropper-target">
											<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="noavatar" />
										</div>
										<div class="large-wrapper">
											<div class="image-container large" id="preview-large">
												<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="noavatar" />
											</div>
											<p class="text-center">大</p>
										</div>
										<div>
											<div class="image-container medium" id="preview-medium">
												<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="noavatar" />
											</div>
											<p>中</p>
											<div class="image-container small" id="preview-small">
												<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="noavatar" />
											</div>
											<p>小</p>
										</div>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div><!-- /.page-body -->
		</div><!-- /.page -->
	</section><!-- /.content -->
</div><!-- 页面容器 -->

<!-- jQuery 2.1.4 -->
<script src="../../src/libs/jQuery/jquery-2.2.3.min.js"></script>
<!-- Bootstrap 3.3.5 -->
<script src="../../src/libs/bootstrap-3.3.6/js/bootstrap.min.js"></script>
<!-- jquery.validate 表单验证-->
<script src="../../src/libs/jquery.validate/jquery.validate.js"></script>
<script src="../../src/libs/jquery.validate/validate.extend.js"></script>
<!-- bootstrap-table -->
<link rel="stylesheet" href="../../src/libs/bootstrap-table/bootstrap-table.css">
<script src="../../src/libs/bootstrap-table/bootstrap-table.min.js"></script>
<!-- WdatePicker.js 自动加载css -->
<script src="../../src/libs/My97DatePicker/WdatePicker.js"></script>
<!-- 弹框layer.js 自动加载css -->
<script src="../../src/libs/layer/layer.js"></script>
<!-- bootstrap-fileinput-->
<link rel="stylesheet" href="../../src/libs/bootstrap-fileinput/bootstrap-fileinput.css">
<script src="../../src/libs/bootstrap-fileinput/bootstrap-fileinput.js"></script>
<!-- cropper 图片裁剪-->
<link rel="stylesheet" href="../../src/libs/cropper/cropper.css">
<script src="../../src/libs/cropper/cropper.js"></script>
<!--公用common.js-->
<script src="../../src/js/common.js"></script>
<!-- 业务逻辑js -->
<script>
	$(function(){
		page.init();
	});
	$(function(){
		var fileinput=$("#fileinput").data("bs.fileinput");
		console.log(fileinput);
	})
	var page=(function(){
		//组件初始化；
		var componentInit=function(){
			$("#img-compress").on("change",function(e){
				common.imgCompress(e.target.files,function(srcs){
					//去掉base64标记
					var values=srcs.map(function(value,index,arr){
						return value.replace(/^data:image\/(png|jpg|jpeg);base64,/, "");
					});
					console.log(values);//提交后可以直接存byte[] Image
				})
			});
		};
		var imgCropper=function(){
			var cropper = new Cropper({
				element: document.getElementById('cropper-target'),
				previews: [
					document.getElementById('preview-large'),
					document.getElementById('preview-medium'),
					document.getElementById('preview-small')
				],
				aspectRatio:1,
				onCroppedRectChange: function(rect) {
					//console.log(rect)
				}
			});
			var input = document.getElementById('cropper-input');
			input.onchange = function() {
				if (typeof FileReader !== 'undefined') {
					var reader = new FileReader();
					reader.onload = function (event) {
						cropper.setImage(event.target.result);
					};
					if (input.files && input.files[0]) {
						reader.readAsDataURL(input.files[0]);
					}
				} else { // IE10以下
					input.select();
					input.blur();

					var src = document.selection.createRange().text;
					cropper.setImage(src);
				}
			};
			$("#btn-upload").on("click",function(){
				$("#cropper-input").trigger("click");
			});
			$("#btn-upload-cropper").on("click",function(){
				var data=cropper.croppedRect;
				console.log(data);//可以获取预览图的src上传或原图+data（裁剪信息）上传
			});
		};
		return {
			init:function(){
				componentInit();
				imgCropper();
			}
		}
	})();
</script>
</body>
</html>